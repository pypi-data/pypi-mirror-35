
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Common usage scenarios &#8212; Aglyph 3.0.0.post1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Component inheritance using templates" href="cookbook-templating.html" />
    <link rel="prev" title="Choose a configuration approach for Aglyph" href="cookbook-configuration.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="common-usage-scenarios">
<h1>Common usage scenarios<a class="headerlink" href="#common-usage-scenarios" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Release:</th><td class="field-body">3.0.0.post1</td>
</tr>
</tbody>
</table>
<p>All examples are shown with XML configuration <em>and</em> programmatic configuration,
where appropriate.</p>
<ul class="simple">
<li><a class="reference internal" href="#simple-component"><span class="std std-ref">Describe a simple component (a class or an unbound factory function)</span></a></li>
<li><a class="reference internal" href="#builtin-components"><span class="std std-ref">Describe any Python builtin type as a component</span></a></li>
<li><a class="reference internal" href="#component-reference"><span class="std std-ref">Use a reference to another component as a dependency</span></a></li>
<li><a class="reference internal" href="#deferred-resolution"><span class="std std-ref">Defer the resolution of injection values until assembly time</span></a></li>
<li><a class="reference internal" href="#after-inject-lifecycle-method"><span class="std std-ref">Declare a method to be called on an object after its dependencies have been injected</span></a></li>
<li><a class="reference internal" href="#before-clear-lifecycle-method"><span class="std std-ref">Declare a method to be called on a singleton, borg, or weakref object before it is cleared from cache</span></a></li>
<li><a class="reference internal" href="#avoid-circular-deps"><span class="std std-ref">Avoid circular dependencies</span></a></li>
</ul>
<div class="section" id="describe-a-simple-component-a-class-or-an-unbound-factory-function">
<span id="simple-component"></span><h2>Describe a simple component (a class or an unbound factory function)<a class="headerlink" href="#describe-a-simple-component-a-class-or-an-unbound-factory-function" title="Permalink to this headline">¶</a></h2>
<p>The simplest and most common kind of component is one that describes a
module-level class or unbound factory function.</p>
<p>To demonstrate, we will describe a component for the Python standard library
<a class="reference external" href="https://docs.python.org/3/library/http.client.html#http.client.HTTPConnection" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">http.client.HTTPConnection</span></code></a> class.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although we are using the Python standard library
<a class="reference external" href="https://docs.python.org/3/library/http.client.html#http.client.HTTPConnection" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">http.client.HTTPConnection</span></code></a> class here, this example applies to
<strong>any</strong> class or unbound function, whether defined as part of your
application, the Python standard library, or a 3rd-party library.</p>
</div>
<div class="section" id="using-declarative-xml-configuration">
<h3>Using declarative XML configuration<a class="headerlink" href="#using-declarative-xml-configuration" title="Permalink to this headline">¶</a></h3>
<p>In the XML context document <em>“cookbook-context.xml”</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;http.client.HTTPConnection&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;ninthtest.info&lt;/str&gt;&lt;/arg&gt;
            &lt;arg&gt;&lt;int&gt;80&lt;/int&gt;
            &lt;arg keyword=&quot;timeout&quot;&gt;&lt;int&gt;5&lt;/int&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
<p>To assemble and use this component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.assembler</span> <span class="k">import</span> <span class="n">Assembler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">XMLContext</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assembler</span> <span class="o">=</span> <span class="n">Assembler</span><span class="p">(</span><span class="n">XMLContext</span><span class="p">(</span><span class="s2">&quot;cookbook-context.xml&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conx</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s2">&quot;http.client.HTTPConnection&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conx</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">conx</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
<span class="go">200 OK</span>
</pre></div>
</div>
<p>If we want to describe more than one component of the same class or function,
then we need to use something other than the dotted name as the component IDs
so that they are unique:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;ninthtest-info-conx&quot; dotted-name=&quot;http.client.HTTPConnection&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;ninthtest.info&lt;/str&gt;&lt;/arg&gt;
            &lt;arg&gt;&lt;int&gt;80&lt;/int&gt;
            &lt;arg keyword=&quot;timeout&quot;&gt;&lt;int&gt;5&lt;/int&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
    &lt;component id=&quot;python-org-conx&quot; dotted-name=&quot;http.client.HTTPConnection&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;www.python.org&lt;/str&gt;&lt;/arg&gt;
            &lt;arg&gt;&lt;int&gt;80&lt;/int&gt;
            &lt;arg keyword=&quot;timeout&quot;&gt;&lt;int&gt;5&lt;/int&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
<p>Accordingly, we use the component IDs to assemble these components:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.assembler</span> <span class="k">import</span> <span class="n">Assembler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">XMLContext</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assembler</span> <span class="o">=</span> <span class="n">Assembler</span><span class="p">(</span><span class="n">XMLContext</span><span class="p">(</span><span class="s2">&quot;cookbook-context.xml&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ninthtest_info</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s2">&quot;ninthtest-info-conx&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">python_org</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s2">&quot;python-org-conx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-fluent-api-configuration">
<h3>Using fluent API configuration<a class="headerlink" href="#using-fluent-api-configuration" title="Permalink to this headline">¶</a></h3>
<p>Using <a class="reference internal" href="context-fluent-api.html"><span class="doc">The Aglyph Context fluent API</span></a> to describe a simple component in a
<em>bindings.py</em> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">http.client</span> <span class="k">import</span> <span class="n">HTTPConnection</span>
<span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">Context</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="s2">&quot;cookbook-context&quot;</span><span class="p">)</span>
<span class="n">context</span><span class="o">.</span><span class="n">prototype</span><span class="p">(</span><span class="n">HTTPConnection</span><span class="p">)</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s2">&quot;ninthtest.info&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
<p>To assemble and use the component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.assembler</span> <span class="k">import</span> <span class="n">Assembler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bindings</span> <span class="k">import</span> <span class="n">context</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assembler</span> <span class="o">=</span> <span class="n">Assembler</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conx</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s2">&quot;http.client.HTTPConnection&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conx</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">conx</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
<span class="go">200 OK</span>
</pre></div>
</div>
<p>And like XML contexts, when we wish to use multiple components of the same
dotted name, we must give them unique component IDs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">http.client</span> <span class="k">import</span> <span class="n">HTTPConnection</span>
<span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">Context</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="s2">&quot;cookbook-context&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">prototype</span><span class="p">(</span><span class="s2">&quot;ninthtest-info-conx&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">create</span><span class="p">(</span><span class="n">HTTPConnection</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;ninthtest.info&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span>
    <span class="n">register</span><span class="p">())</span>
<span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">prototype</span><span class="p">(</span><span class="s2">&quot;python-org-conx&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">create</span><span class="p">(</span><span class="n">HTTPConnection</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;www.python.org&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span>
    <span class="n">register</span><span class="p">())</span>
</pre></div>
</div>
<p>Assembling these components now requires the custom component IDs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.assembler</span> <span class="k">import</span> <span class="n">Assembler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bindings</span> <span class="k">import</span> <span class="n">context</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assembler</span> <span class="o">=</span> <span class="n">Assembler</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ninthtest_info</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s2">&quot;ninthtest-info-conx&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">python_org</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s2">&quot;python-org-conx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="describe-any-python-builtin-type-as-a-component">
<span id="builtin-components"></span><h2>Describe any Python builtin type as a component<a class="headerlink" href="#describe-any-python-builtin-type-as-a-component" title="Permalink to this headline">¶</a></h2>
<p>Python builtin types (e.g. <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a>) can be identified by an
importable dotted name, and so may be defined as components in Aglyph.</p>
<div class="section" id="id1">
<h3>Using declarative XML configuration<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The name of the module in which builtin types are defined differs between
Python 2 and 3, so any Aglyph XML configuration that uses this approach
will, by definition, <strong>not</strong> be compatible across Python versions.</p>
<p class="last">The example given below uses the Python 3 <a class="reference external" href="https://docs.python.org/3/library/builtins.html#module-builtins" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">builtins</span></code></a> module. To make
this example work on Python 2, the <code class="docutils literal notranslate"><span class="pre">__builtin__</span></code> module would be used
instead.</p>
</div>
<p>In the XML context document <em>“cookbook-context.xml”</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;foods&quot; dotted-name=&quot;builtins.frozenset&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;
                &lt;list&gt;
                    &lt;str&gt;spam&lt;/str&gt;
                    &lt;str&gt;eggs&lt;/str&gt;
                &lt;/list&gt;
            &lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
    &lt;component id=&quot;opened-file&quot; dotted-name=&quot;builtins.open&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;/path/to/file.txt&lt;/str&gt;&lt;/arg&gt;
            &lt;arg keyword=&quot;encoding&quot;&gt;&lt;str&gt;ISO-8859-1&lt;/str&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>Using fluent API configuration<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Because the builtin types are accessible without having to do an explicit
import, the fluent configuration is very simple.</p>
<p>In a <em>bindings.py</em> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">Context</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="s2">&quot;cookbook-context&quot;</span><span class="p">)</span>
<span class="n">context</span><span class="o">.</span><span class="n">prototype</span><span class="p">(</span><span class="s2">&quot;foods&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">)</span><span class="o">.</span><span class="n">init</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">prototype</span><span class="p">(</span><span class="s2">&quot;opened-file&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">create</span><span class="p">(</span><span class="nb">open</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;/path/to/file.txt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;ISO-8859-1&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">register</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-a-reference-to-another-component-as-a-dependency">
<span id="component-reference"></span><h2>Use a reference to another component as a dependency<a class="headerlink" href="#use-a-reference-to-another-component-as-a-dependency" title="Permalink to this headline">¶</a></h2>
<p>An <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Reference</span></code></a> is a powerful mechanism for creating
cross-references between components.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">Reference</span></code> value is just a component ID, but a <code class="docutils literal notranslate"><span class="pre">Reference</span></code> triggers
special behavior within an <a class="reference internal" href="aglyph.assembler.html#aglyph.assembler.Assembler" title="aglyph.assembler.Assembler"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.assembler.Assembler</span></code></a> or
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Evaluator</span></code></a> when it is encountered during assembly or
evaluation (respectively): wherever the <code class="docutils literal notranslate"><span class="pre">Reference</span></code> appears, it will be
automatically replaced with the fully-assembled component it identifies.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">Reference</span></code> may be used in <em>any</em> of the following places, allowing for
extremely flexible configurations:</p>
<ul class="simple">
<li>an initialization argument value (positional or keyword) for an
<a class="reference internal" href="aglyph.component.html#aglyph.component.Component" title="aglyph.component.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Component</span></code></a> or an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Evaluator</span></code></a></li>
<li>an attribute value for an <a class="reference internal" href="aglyph.component.html#aglyph.component.Component" title="aglyph.component.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Component</span></code></a></li>
<li>a key and/or value of a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a></li>
<li>an item of any sequence type (e.g. <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code></a>)</li>
</ul>
<p>In a nutshell: an <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Reference</span></code></a> may be used in <em>any</em>
case where a value is being defined, and will be replaced at assembly-time by
the fully-assembled component identified by that reference.</p>
<p>To demonstrate, we will describe components for the Python standard library
<a class="reference external" href="https://docs.python.org/3/library/urllib.request.html#urllib.request.Request" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">urllib.request.Request</span></code></a> class and <a class="reference external" href="https://docs.python.org/3/library/urllib.request.html#urllib.request.urlopen" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.request.urlopen()</span></code></a>
function. (The former will be referenced as a dependency for the latter.)</p>
<div class="section" id="id3">
<h3>Using declarative XML configuration<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>In the <em>“cookbook-context.xml”</em> document:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;ninthtest-home-page&quot; dotted-name=&quot;urllib.request.Request&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;http://ninthtest.info/&lt;/str&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
    &lt;component id=&quot;ninthtest-url&quot; dotted-name=&quot;urllib.request.urlopen&quot;&gt;
        &lt;init&gt;
            &lt;arg reference=&quot;ninthtest-home-page&quot; /&gt;
            &lt;arg keyword=&quot;timeout&quot;&gt;&lt;int&gt;5&lt;/int&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
<p>When the <em>“ninthtest-url”</em> component is assembled, the assembler will
automatically assemble and inject the <em>“ninthtest-home-page”</em> component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.assembler</span> <span class="k">import</span> <span class="n">Assembler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">XMLContext</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assembler</span> <span class="o">=</span> <span class="n">Assembler</span><span class="p">(</span><span class="n">XMLContext</span><span class="p">(</span><span class="s2">&quot;cookbook-context.xml&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ninthtest_url</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s2">&quot;ninthtest-url&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ninthtest_url</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">ninthtest_url</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
<span class="go">200 OK</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>Using fluent API configuration<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>In a <em>bindings.py</em> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urllib.request</span> <span class="k">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">Context</span>
<span class="kn">from</span> <span class="nn">aglyph.component</span> <span class="k">import</span> <span class="n">Reference</span> <span class="k">as</span> <span class="n">ref</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="s2">&quot;cookbook-context&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s2">&quot;ninthtest-home-page&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">create</span><span class="p">(</span><span class="n">Request</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;http://ninthtest.info/&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">register</span><span class="p">())</span>
<span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s2">&quot;ninthtest-url&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">create</span><span class="p">(</span><span class="n">urlopen</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;ninthtest-home-page&quot;</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span>
    <span class="n">register</span><span class="p">())</span>
</pre></div>
</div>
<p>When the <em>“ninthtest-url”</em> component is assembled, the assembler will
automatically assemble and inject the <em>“ninthtest-home-page”</em> component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">aglyph.assembler</span> <span class="k">import</span> <span class="n">Assembler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bindings</span> <span class="k">import</span> <span class="n">context</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assembler</span> <span class="o">=</span> <span class="n">Assembler</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ninthtest_url</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s2">&quot;ninthtest-url&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ninthtest_url</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">ninthtest_url</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
<span class="go">200 OK</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="defer-the-resolution-of-injection-values-until-assembly-time">
<span id="deferred-resolution"></span><h2>Defer the resolution of injection values until assembly time<a class="headerlink" href="#defer-the-resolution-of-injection-values-until-assembly-time" title="Permalink to this headline">¶</a></h2>
<p>When specifying the values that should be injected into an object of a
component as it is assembled, it is sometimes desired (or necessary) that
those values be resolved <strong>at the time the component is being assembled.</strong></p>
<p>The textbook example of such a case is a component that accepts some mutable
sequence type (e.g. a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a>) as an injection value. If the value (the
list) were resolved at the time the component is being defined, then all
objects of that component would share a reference to the same list This means
that changes to the list belonging to <em>any</em> instance will actually apply to
<em>all</em> instances.</p>
<p>In almost all cases, this is not desired behavior. What we actually desire is
for each instance of the component to have its <em>own</em> copy of the list.</p>
<p>The solution to this problem is to specify a dependency such that its actual
value is determined on-the-fly when the component is being assembled. Aglyph
supports several ways of accomplishing this.</p>
<div class="section" id="use-a-reference-to-defer-the-assembly-of-a-component">
<span id="deferred-reference"></span><h3>Use a Reference to defer the assembly of a component<a class="headerlink" href="#use-a-reference-to-defer-the-assembly-of-a-component" title="Permalink to this headline">¶</a></h3>
<p>Whenever an <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Reference</span></code></a> is used to identify a component
as a dependency, that component is not assembled until the <em>parent</em> component
is assembled.</p>
<div class="section" id="id5">
<h4>Using declarative XML configuration<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>Aglyph automatically creates an <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Reference</span></code></a> for any
<code class="docutils literal notranslate"><span class="pre">&lt;reference&gt;</span></code> element encountered, or for any <code class="docutils literal notranslate"><span class="pre">&lt;arg&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;attribute&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;key&gt;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&lt;value&gt;</span></code> element that specifies a <code class="docutils literal notranslate"><span class="pre">reference</span></code> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;cookbook-formatter&quot; dotted-name=&quot;logging.Formatter&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;%(asctime)s %(levelname)s %(message)s&lt;/str&gt;&lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
    &lt;component id=&quot;cookbook-handler&quot; dotted-name=&quot;logging.handlers.RotatingFileHandler&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;/var/log/cookbook.log&lt;/str&gt;&lt;/arg&gt;
            &lt;arg keyword=&quot;maxBytes&quot;&gt;&lt;int&gt;1048576&lt;/int&gt;&lt;/arg&gt;
            &lt;arg keyword=&quot;backupCount&quot;&gt;&lt;int&gt;3&lt;/int&gt;&lt;/arg&gt;
        &lt;/init&gt;
        &lt;attributes&gt;
            &lt;attribute name=&quot;setFormatter&quot;&gt;
                &lt;reference id=&quot;cookbook-formatter&quot; /&gt;
            &lt;/attribute&gt;
        &lt;/attributes&gt;
    &lt;/component&gt;
    &lt;component id=&quot;cookbook-logger&quot; dotted-name=&quot;logging.getLogger&quot; strategy=&quot;singleton&quot;&gt;
        &lt;init&gt;
            &lt;arg&gt;&lt;str&gt;cookbook&lt;/str&gt;&lt;/arg&gt;
        &lt;/init&gt;
        &lt;attributes&gt;
            &lt;attribute name=&quot;addHandler&quot; ref=&quot;cookbook-handler&quot; /&gt;
        &lt;/attributes&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>Using fluent API configuration<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>In a <em>bindings.py</em> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">Context</span>
<span class="kn">from</span> <span class="nn">aglyph.component</span> <span class="k">import</span> <span class="n">Reference</span> <span class="k">as</span> <span class="n">ref</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="s2">&quot;cookbook-context&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s2">&quot;cookbook-formatter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;logging.Formatter&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">register</span><span class="p">())</span>
<span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s2">&quot;cookbook-handler&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;logging.handlers.RotatingFileHandler&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;/var/log/cookbook.log&quot;</span><span class="p">,</span> <span class="n">maxBytes</span><span class="o">=</span><span class="mi">1048576</span><span class="p">,</span> <span class="n">backupCount</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span>
    <span class="nb">set</span><span class="p">(</span><span class="n">setFormatter</span><span class="o">=</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;cookbook-formatter&quot;</span><span class="p">))</span><span class="o">.</span>
    <span class="n">register</span><span class="p">())</span>
<span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">singleton</span><span class="p">(</span><span class="s2">&quot;cookbook-logger&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;logging.getLogger&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;cookbook&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">attributes</span><span class="p">(</span><span class="n">addHandler</span><span class="o">=</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;cookbook-handler&quot;</span><span class="p">))</span><span class="o">.</span>
    <span class="n">register</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-a-partial-function-or-an-evaluator-to-defer-the-evaluation-of-a-runtime-value">
<span id="deferred-partial-evaluator"></span><h3>Use a partial function or an Evaluator to defer the evaluation of a runtime value<a class="headerlink" href="#use-a-partial-function-or-an-evaluator-to-defer-the-evaluation-of-a-runtime-value" title="Permalink to this headline">¶</a></h3>
<p>Though almost all scenarios can be addressed by using components and
References, in some cases you may prefer that a dependency is <em>not</em> defined as
another component. In Aglyph, you can defer the evaluation of such a value
until component assembly time by using either a <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">functools.partial</span></code></a> object
or an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Evaluator</span></code></a>.</p>
<p>A partial function and an Evaluator serve the same purpose, and share the same
signature - <em>(func, *args, **keywords)</em> - but an Evaluator is capable of
recognizing and assembling any <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Reference</span></code></a> that appears
in <em>args</em> or <em>keywords</em>, while a partial function is not.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When the arguments and/or keywords to a callable must specify an
<a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Reference</span></code></a>, use
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Evaluator</span></code></a>. Otherwise, use either
<a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">functools.partial</span></code></a> <em>or</em> an Evaluator.</p>
</div>
<div class="section" id="id7">
<h4>Using declarative XML configuration<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>When using XML configuration, an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Evaluator</span></code></a> is
<em>automatically</em> created for any <code class="docutils literal notranslate"><span class="pre">&lt;list&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;tuple&gt;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&lt;dict&gt;</span></code>.</p>
<p>There is no support for explicitly specifying either a <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">functools.partial</span></code></a>
or an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Evaluator</span></code></a>. There is nothing <em>preventing</em> you
from declaring a component of <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">functools.partial</span></code></a> or
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Evaluator</span></code></a>, though the usefulness of the latter is
questionable (and would very strongly suggest that a simpler configuration
is possible).</p>
<p>In the following <em>“cookbook-context.xml”</em> document, the “states” keyword
argument is automatically turned into an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Evaluator</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
    &lt;component id=&quot;cookbook.WorkflowManager&quot;&gt;
        &lt;init&gt;
            &lt;arg keyword=&quot;states&quot;&gt;
                &lt;dict&gt;
                    &lt;item&gt;
                        &lt;key&gt;&lt;str&gt;UNA&lt;/str&gt;&lt;/key&gt;
                        &lt;value&gt;&lt;str&gt;Unassigned&lt;/str&gt;&lt;/value&gt;
                    &lt;/item&gt;
                    &lt;item&gt;
                        &lt;key&gt;&lt;str&gt;OPE&lt;/str&gt;&lt;/key&gt;
                        &lt;value&gt;&lt;str&gt;Open (Assigned)&lt;/str&gt;&lt;/value&gt;
                    &lt;/item&gt;
                    &lt;item&gt;
                        &lt;key&gt;&lt;str&gt;CLO&lt;/str&gt;&lt;/key&gt;
                        &lt;value&gt;&lt;str&gt;Closed&lt;/str&gt;&lt;/value&gt;
                    &lt;/item&gt;
                &lt;/dict&gt;
            &lt;/arg&gt;
        &lt;/init&gt;
    &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h4>Using fluent API configuration<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Unlike XML configuration, there is no provision for automatically creating
an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Evaluator</span></code></a> when using <a class="reference internal" href="context-fluent-api.html"><span class="doc">The Aglyph Context fluent API</span></a>. Any value that
should be the result of a <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">functools.partial</span></code></a> or an
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.component.Evaluator</span></code></a> must be <strong>explicitly</strong> specified as
such.</p>
</div>
<p>In a <em>bindings.py</em> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">Context</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="s2">&quot;cookbook-context&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s2">&quot;cookbook.WorkflowManager&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
        <span class="nb">dict</span><span class="p">,</span>
        <span class="n">UNA</span><span class="o">=</span><span class="s2">&quot;Unassigned&quot;</span><span class="p">,</span>
        <span class="n">OPE</span><span class="o">=</span><span class="s2">&quot;Open (Assigned)&quot;</span><span class="p">,</span>
        <span class="n">CLO</span><span class="o">=</span><span class="s2">&quot;Closed&quot;</span><span class="p">))</span><span class="o">.</span>
    <span class="n">register</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="declare-a-method-to-be-called-on-an-object-after-its-dependencies-have-been-injected">
<span id="after-inject-lifecycle-method"></span><h2>Declare a method to be called on an object after its dependencies have been injected<a class="headerlink" href="#declare-a-method-to-be-called-on-an-object-after-its-dependencies-have-been-injected" title="Permalink to this headline">¶</a></h2>
<p>At times it may be desirable (or necessary) to call an “initialization” method
on an assembled object before it is returned to the caller for use. For this
purpose, Aglyph allows you to declare such a method name at the context,
template, and/or component level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please refer to <a class="reference internal" href="aglyph.component.html#lifecycle-method-lookup-process"><span class="std std-ref">The lifecycle method lookup process</span></a> to understand how Aglyph determines
<em>which</em> lifecycle method to call on an object when multiple options are
declared at the context, template, and/or component level for a given
object.</p>
</div>
<p>In the following examples, we assume that all of the objects implement a
<code class="docutils literal notranslate"><span class="pre">prepare()</span></code> method. In such cases, a context-level <code class="docutils literal notranslate"><span class="pre">after_inject</span></code> lifecycle
method may be appropriate. Alternatively, it could be declared in a template
(see <a class="reference internal" href="cookbook-templating.html"><span class="doc">Component inheritance using templates</span></a>).</p>
<p>Regardless of the configuration approach, the behavior is that the assembled
object’s <code class="docutils literal notranslate"><span class="pre">prepare()</span></code> method is called <strong>after</strong> the object is injected but
<strong>before</strong> the object is returned to the caller.</p>
<div class="section" id="id9">
<h3>Using declarative XML configuration<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Note the use of the <em>after-inject</em> attribute on the <code class="docutils literal notranslate"><span class="pre">&lt;context&gt;</span></code> element:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot; after-inject=&quot;prepare&quot;&gt;
   &lt;component id=&quot;object-a&quot; dotted-name=&quot;cookbook.PreparableObjectA&quot; /&gt;
   &lt;component id=&quot;object-b&quot; dotted-name=&quot;cookbook.PreparableObjectB&quot; /&gt;
   &lt;component id=&quot;object-c&quot; dotted-name=&quot;cookbook.PreparableObjectC&quot; /&gt;
&lt;/context&gt;
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>Using fluent API configuration<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Note the use of the <em>after_inject</em> keyword argument to the <code class="docutils literal notranslate"><span class="pre">call(...)</span></code>
method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">Context</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="s2">&quot;cookbook-context&quot;</span><span class="p">,</span> <span class="n">after_inject</span><span class="o">=</span><span class="s2">&quot;prepare&quot;</span><span class="p">)</span>
<span class="n">context</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s2">&quot;object-a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;cookbook.PreparableObjectA&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">context</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s2">&quot;object-b&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;cookbook.PreparableObjectB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">context</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s2">&quot;object-c&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;cookbook.PreparableObjectC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
<p>Additionally, the fluent API supports a <code class="docutils literal notranslate"><span class="pre">call(...)</span></code> method that may be used
to specify a lifecycle method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">context</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s2">&quot;cookbook.AnotherObject&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">after_inject</span><span class="o">=</span><span class="s2">&quot;ready&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="declare-a-method-to-be-called-on-a-singleton-borg-or-weakref-object-before-it-is-cleared-from-cache">
<span id="before-clear-lifecycle-method"></span><h2>Declare a method to be called on a <em>singleton</em>, <em>borg</em>, or <em>weakref</em> object before it is cleared from cache<a class="headerlink" href="#declare-a-method-to-be-called-on-a-singleton-borg-or-weakref-object-before-it-is-cleared-from-cache" title="Permalink to this headline">¶</a></h2>
<p>At times it may be desirable (or necessary) to call a “finalization” method on
a cached object before it is cleared from Aglyph’s internal cache. For this
purpose, Aglyph allows you to declare such a method name at the context,
template, and/or component level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please refer to <a class="reference internal" href="aglyph.component.html#lifecycle-method-lookup-process"><span class="std std-ref">The lifecycle method lookup process</span></a> to understand how Aglyph determines
<em>which</em> lifecycle method to call on an object when multiple options are
declared at the context, template, and/or component level for a given
object.</p>
</div>
<p>Following is an example that declares a <em>singleton</em> <a class="reference external" href="https://www.gnu.org.ua/software/gdbm/">GNU dbm</a> key/date store
using Python’s <a class="reference external" href="https://docs.python.org/3/library/dbm.html#module-dbm.gnu" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">dbm.gnu</span></code></a> module. The store is configured to be opened in
“fast” mode, meaning that writes are not synchronized. When using GDBM, it is
important that every file opened is also closed (which causes any pending writes
to be synchronized - i.e. written to disk). The example shows how to declare that
the <code class="docutils literal notranslate"><span class="pre">close()</span></code> method is to be called before the cached GDBM object is evicted
from the Aglyph singleton cache.</p>
<div class="section" id="id11">
<h3>Using declarative XML configuration<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Here we declare the <code class="docutils literal notranslate"><span class="pre">close()</span></code> method for the <code class="docutils literal notranslate"><span class="pre">before_clear</span></code> lifecycle state
of the component by using the <em>before-clear</em> attribute of the <code class="docutils literal notranslate"><span class="pre">&lt;component&gt;</span></code>
element:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;context id=&quot;cookbook-context&quot;&gt;
   &lt;component id=&quot;store&quot; dotted-name=&quot;dbm.gnu&quot; factory-name=&quot;open&quot;
         strategy=&quot;singleton&quot; before-clear=&quot;close&quot;&gt;
      &lt;init&gt;
         &lt;arg&gt;&lt;str&gt;/var/cookbook-store.db&lt;/str&gt;&lt;/arg&gt;
         &lt;arg&gt;&lt;str&gt;cf&lt;/str&gt;&lt;/arg&gt;
      &lt;/init&gt;
   &lt;/component&gt;
&lt;/context&gt;
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h3>Using fluent API configuration<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Here we use the <em>before_clear</em> keyword argument when binding the GDBM store
object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aglyph.context</span> <span class="k">import</span> <span class="n">Context</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="s2">&quot;cookbook-context&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">singleton</span><span class="p">(</span><span class="s2">&quot;store&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">create</span><span class="p">(</span><span class="s2">&quot;dbm.gnu&quot;</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="s2">&quot;open&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;/var/cookbook-store.db&quot;</span><span class="p">,</span> <span class="s2">&quot;cf&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">call</span><span class="p">(</span><span class="n">before_clear</span><span class="o">=</span><span class="s2">&quot;close&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">register</span><span class="p">())</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be careful when declaring <code class="docutils literal notranslate"><span class="pre">before_clear</span></code> lifecycle methods for <em>weakref</em>
component objects, as the nature of weak references means that Aglyph
<strong>cannot</strong> guarantee that the object still exists when the
<a class="reference internal" href="aglyph.assembler.html#aglyph.assembler.Assembler.clear_weakrefs" title="aglyph.assembler.Assembler.clear_weakrefs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aglyph.assembler.Assembler.clear_weakrefs()</span></code></a> method is called! Please
refer to <a class="reference external" href="https://docs.python.org/3/library/weakref.html#module-weakref" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">weakref</span></code></a> for details.</p>
</div>
</div>
</div>
<div class="section" id="avoid-circular-dependencies">
<span id="avoid-circular-deps"></span><h2>Avoid circular dependencies<a class="headerlink" href="#avoid-circular-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Consider two components, <strong>A</strong> and <strong>B</strong>. If <strong>B</strong> is a dependency of <strong>A</strong>,
and <strong>A</strong> is also a dependency of <strong>B</strong>, then a circular dependency exists:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">component</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;cookbook.A&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">init</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">arg</span> <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;cookbook.B&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">init</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">comonent</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">component</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;cookbook.B&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">init</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">arg</span> <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;cookbook.A&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">init</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">comonent</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Aglyph will raise <a class="reference internal" href="aglyph.html#aglyph.AglyphError" title="aglyph.AglyphError"><code class="xref py py-class docutils literal notranslate"><span class="pre">aglyph.AglyphError</span></code></a> when it detects a circular
reference during assembly.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In software design in general, circular dependencies are frowned upon
because they can lead to problems ranging from increased maintenance costs
to infinite recursion and memory leaks. The existence of a circular
dependency usually implies that the design can be improved to avoid such a
relationship.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Aglyph</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whats-new.html">What’s new in release 3.0.0.post1?</a></li>
<li class="toctree-l1"><a class="reference internal" href="get-started.html">Getting started with Aglyph</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="cookbook.html">Aglyph cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cookbook-understanding.html">Understand the general features of Aglyph</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook-configuration.html">Choose a configuration approach for Aglyph</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Common usage scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook-templating.html">Component inheritance using templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook-notable.html">Other notable usage scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook-integration.html">Integrating Aglyph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api-ref.html">Aglyph API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="context-fluent-api.html">The Aglyph Context fluent API</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Aglyph 3.0.0.post1 testing summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Roadmap for future releases</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="cookbook.html">Aglyph cookbook</a><ul>
      <li>Previous: <a href="cookbook-configuration.html" title="previous chapter">Choose a configuration approach for Aglyph</a></li>
      <li>Next: <a href="cookbook-templating.html" title="next chapter">Component inheritance using templates</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2006, 2011, 2013-2018 Matthew Zipay.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.8</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="_sources/cookbook-common.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>