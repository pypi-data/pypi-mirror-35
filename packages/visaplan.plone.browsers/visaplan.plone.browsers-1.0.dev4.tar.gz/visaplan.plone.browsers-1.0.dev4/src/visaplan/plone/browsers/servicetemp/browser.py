from dayta.browser.public import BrowserView, implements, Interface

# Standardmodule:
from DateTime import DateTime


class IServiceTemp(Interface):

    pass


class Browser(BrowserView):

    implements(IServiceTemp)

    def __call__(self):
        """ """
        context = self.context

        portal = context.getAdapter('portal')()
        sm = portal.getAdapter('securitymanager')
        sm(userId='system')
        sm.setNew()

        temp = portal.getBrowser('temp')
        pu = context.getAdapter('pu')()
        folder = temp.getTempFolder()
        now = DateTime() - 2

        for id, object_ in folder.ZopeFind(obj=folder):
            if pu.isIDAutoGenerated(id) and object_.created() < now and not object_.Title():
                object_.restrictedTraverse('@@plone_lock_operations').force_unlock(redirect=False)
                folder.manage_delObjects(ids=[id])

        sm.setOld()

        return True
