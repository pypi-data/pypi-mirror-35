{"version":3,"sources":["webpack:///./src/common/auth/external_auth.js"],"names":["home_assistant_js_websocket__WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","CALLBACK_METHOD","window","externalApp","webkit","Error","ExternalAuth","a","constructor","hassUrl","super","this","data","access_token","expires","[object Object]","meth","getExternalAuth","messageHandlers","postMessage","responseProm","Promise","resolve","callback","tokens","expires_in","Date","now"],"mappings":"wIAAA,IAAAA,EAAAC,EAAA,IAKA,MAAMC,EAAkB,uBAExB,IAAKC,OAAOC,cAAgBD,OAAOE,OACjC,MAAM,IAAIC,MAAM,uFAGGC,UAAqBP,EAAAQ,EACxCC,YAAYC,GACVC,QAEAC,KAAKC,MACHH,UACAI,aAAc,GAEdC,QAAS,GAIbC,2BACE,MAAMC,EAAOd,OAAOC,YAClBD,OAAOC,YAAYc,gBACnBf,OAAOE,OAAOc,gBAAgBD,gBAAgBE,YAE1CC,EAAe,IAAIC,QAASC,IAAcpB,OAAOD,GAAmBqB,UAGpE,EAENN,GAAOO,SAAUtB,IAOjB,MAAMuB,QAAeJ,EAErBT,KAAKC,KAAKC,aAAeW,EAAOX,aAChCF,KAAKC,KAAKE,QAA+B,IAApBU,EAAOC,WAAqBC,KAAKC","file":"05b110ccfaa07b7d19b5.chunk.js","sourcesContent":["/**\n * Auth class that connects to a native app for authentication.\n */\nimport { Auth } from 'home-assistant-js-websocket';\n\nconst CALLBACK_METHOD = 'externalAuthSetToken';\n\nif (!window.externalApp && !window.webkit) {\n  throw new Error('External auth requires either externalApp or webkit defined on Window object.');\n}\n\nexport default class ExternalAuth extends Auth {\n  constructor(hassUrl) {\n    super();\n\n    this.data = {\n      hassUrl,\n      access_token: '',\n      // This will trigger connection to do a refresh right away\n      expires: 0,\n    };\n  }\n\n  async refreshAccessToken() {\n    const meth = window.externalApp ?\n      window.externalApp.getExternalAuth :\n      window.webkit.messageHandlers.getExternalAuth.postMessage;\n\n    const responseProm = new Promise((resolve) => { window[CALLBACK_METHOD] = resolve; });\n\n    // Allow promise to set resolve on window object.\n    await 0;\n\n    meth({ callback: CALLBACK_METHOD });\n\n    // Response we expect back:\n    // {\n    //   \"access_token\": \"qwere\",\n    //   \"expires_in\": 1800\n    // }\n    const tokens = await responseProm;\n\n    this.data.access_token = tokens.access_token;\n    this.data.expires = (tokens.expires_in * 1000) + Date.now();\n  }\n}\n"],"sourceRoot":""}