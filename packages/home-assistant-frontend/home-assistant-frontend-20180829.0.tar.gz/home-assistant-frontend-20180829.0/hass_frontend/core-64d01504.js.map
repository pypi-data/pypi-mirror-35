{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/entrypoints/core.js","webpack:///./src/common/util/parse_query.js","webpack:///./src/common/auth/token_storage.js","webpack:///./node_modules/home-assistant-js-websocket/dist/haws.es.js","webpack:///./src/common/auth/token.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","default","object","property","prototype","hasOwnProperty","p","s","187","__webpack_exports__","haws_es","token","token_storage","init","window","createHassConnection","password","accessToken","url","location","protocol","host","options","setupRetry","authToken","access_token","expires","then","conn","e","useOAuth","search","query","queryString","items","substr","split","length","item","decodeURIComponent","code","hassConnection","newTokens","tokens","Date","now","b","catch","err","a","noAuth","localStorage","addEventListener","homeAssistant","document","querySelector","hass","callService","logger","replace","message","filename","lineno","colno","loadTokens","storage","tokenCache","__tokenCache","askWrite","writeEnabled","storeTokens","JSON","stringify","enableWrite","parse","undefined","subscribeEntities","ERR_CANNOT_CONNECT","ERR_INVALID_AUTH","MSG_TYPE_AUTH_REQUIRED","MSG_TYPE_AUTH_INVALID","MSG_TYPE_AUTH_OK","getSocket","f","g","WebSocket","h","removeEventListener","setTimeout","j","data","type","send","api_password","close","Promise","extractResult","result","Connection","this","commandId","commands","eventListeners","closeRequested","_handleMessage","_handleClose","createConnection","setSocket","subscribeConfig","_subscribeConfig","push","assign","services","all","getConfig","getServices","core","splice","indexOf","subscribeEvents","components","concat","component","domain","service","description","fields","keys","forEach","_subscribeEntities","getStates","entity_id","k","new_state","socket","eventType","eventCallback","unsubscribe","fireEvent","sendMessagePromise","service_data","event_type","subscription","id","ping","sendMessage","resolve","reject","event","success","error","Math","min","65","redirectLogin","resolveCode","refreshToken","_token_storage_js__WEBPACK_IMPORTED_MODULE_0__","genClientId","href","encodeURIComponent","toString","FormData","append","fetch","credentials","method","body","resp","ok","Error","json","expires_in","history","replaceState","pathname","console","alert","refresh_token","accessTokenResp"],"mappings":"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","file":"core-64d01504.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/frontend_latest/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 187);\n","import {\n  ERR_INVALID_AUTH,\n  createConnection,\n  subscribeConfig,\n  subscribeEntities,\n} from 'home-assistant-js-websocket';\n\nimport { redirectLogin, resolveCode, refreshToken } from '../common/auth/token.js';\n// import refreshToken_ from '../common/auth/refresh_token.js';\nimport parseQuery from '../common/util/parse_query.js';\nimport { loadTokens } from '../common/auth/token_storage.js';\n\nconst init = window.createHassConnection = function (password, accessToken) {\n  const proto = window.location.protocol === 'https:' ? 'wss' : 'ws';\n  const url = `${proto}://${window.location.host}/api/websocket?${__BUILD__}`;\n  const options = {\n    setupRetry: 10,\n  };\n  if (password) {\n    options.authToken = password;\n  } else if (accessToken) {\n    options.accessToken = accessToken.access_token;\n    options.expires = accessToken.expires;\n  }\n  return createConnection(url, options)\n    .then(function (conn) {\n      subscribeEntities(conn);\n      subscribeConfig(conn);\n      return conn;\n    });\n};\n\nfunction main() {\n  if (location.search) {\n    const query = parseQuery(location.search.substr(1));\n    if (query.code) {\n      window.hassConnection = resolveCode(query.code).then(newTokens => init(null, newTokens));\n      return;\n    }\n  }\n  const tokens = loadTokens();\n\n  if (tokens == null) {\n    redirectLogin();\n    return;\n  }\n\n  if (Date.now() + 30000 > tokens.expires) {\n    // refresh access token if it will expire in 30 seconds to avoid invalid auth event\n    window.hassConnection = refreshToken().then(newTokens => init(null, newTokens));\n    return;\n  }\n\n  window.hassConnection = init(null, tokens).catch((err) => {\n    if (err !== ERR_INVALID_AUTH) throw err;\n\n    return refreshToken().then(newTokens => init(null, newTokens));\n  });\n}\n\nfunction mainLegacy() {\n  if (window.noAuth === '1') {\n    window.hassConnection = init();\n  } else if (window.localStorage.authToken) {\n    window.hassConnection = init(window.localStorage.authToken);\n  } else {\n    window.hassConnection = null;\n  }\n}\n\nif (window.useOAuth === '1') {\n  main();\n} else {\n  mainLegacy();\n}\n\nwindow.addEventListener('error', (e) => {\n  const homeAssistant = document.querySelector('home-assistant');\n  if (homeAssistant && homeAssistant.hass && homeAssistant.hass.callService) {\n    homeAssistant.hass.callService('system_log', 'write', {\n      logger: `frontend.${__DEV__ ? 'js_dev' : 'js'}.${__BUILD__}.${__VERSION__.replace('.', '')}`,\n      message: `${e.filename}:${e.lineno}:${e.colno} ${e.message}`,\n    });\n  }\n});\n","export default function parseQuery(queryString) {\n  const query = {};\n  const items = queryString.split('&');\n  for (let i = 0; i < items.length; i++) {\n    const item = items[i].split('=');\n    const key = decodeURIComponent(item[0]);\n    const value = item.length > 1 ? decodeURIComponent(item[1]) : undefined;\n    query[key] = value;\n  }\n  return query;\n}\n","const storage = window.localStorage || {};\n\n// So that core.js and main app hit same shared object.\nlet tokenCache = window.__tokenCache;\nif (!tokenCache) {\n  tokenCache = window.__tokenCache = {\n    tokens: undefined,\n    writeEnabled: undefined,\n  };\n}\n\nexport function askWrite() {\n  return tokenCache.tokens !== undefined && tokenCache.writeEnabled === undefined;\n}\n\nexport function storeTokens(tokens) {\n  tokenCache.tokens = tokens;\n  if (tokenCache.writeEnabled) {\n    try {\n      storage.tokens = JSON.stringify(tokens);\n    } catch (err) {}  // eslint-disable-line\n  }\n}\n\nexport function enableWrite() {\n  tokenCache.writeEnabled = true;\n  storeTokens(tokenCache.tokens);\n}\n\nexport function loadTokens() {\n  if (tokenCache.tokens === undefined) {\n    try {\n      const tokens = storage.tokens;\n      if (tokens) {\n        tokenCache.tokens = JSON.parse(tokens);\n        tokenCache.writeEnabled = true;\n      } else {\n        tokenCache.tokens = null;\n      }\n    } catch (err) {\n      tokenCache.tokens = null;\n    }\n  }\n  return tokenCache.tokens;\n}\n","function auth(a){return{type:'auth',api_password:a}}function authAccessToken(a){return{type:'auth',access_token:a}}function states(){return{type:'get_states'}}function config(){return{type:'get_config'}}function services(){return{type:'get_services'}}function callService(a,b,c){var d={type:'call_service',domain:a,service:b};return c&&(d.service_data=c),d}function subscribeEvents(a){var b={type:'subscribe_events'};return a&&(b.event_type=a),b}function unsubscribeEvents(a){return{type:'unsubscribe_events',subscription:a}}function ping(){return{type:'ping'}}function error(a,b){return{type:'result',success:!1,error:{code:a,message:b}}}var ERR_CANNOT_CONNECT=1,ERR_INVALID_AUTH=2,ERR_CONNECTION_LOST=3,MSG_TYPE_AUTH_REQUIRED='auth_required',MSG_TYPE_AUTH_INVALID='auth_invalid',MSG_TYPE_AUTH_OK='auth_ok',MSG_TYPE_EVENT='event',MSG_TYPE_RESULT='result',MSG_TYPE_PONG='pong';function getSocket(a,b){function c(d,e,f){var g=new WebSocket(a),h=!1,i=function(){if(g.removeEventListener('close',i),h)return void f(ERR_INVALID_AUTH);if(0===d)return void f(ERR_CANNOT_CONNECT);var a=-1===d?-1:d-1;setTimeout(function(){return c(a,e,f)},1e3)},j=function(a){var c=JSON.parse(a.data);switch(c.type){case MSG_TYPE_AUTH_REQUIRED:b.authToken?g.send(JSON.stringify(auth(b.authToken))):b.accessToken?b.expires!==void 0&&Date.now()>b.expires?(h=!0,g.close()):g.send(JSON.stringify(authAccessToken(b.accessToken))):(h=!0,g.close());break;case MSG_TYPE_AUTH_INVALID:h=!0,g.close();break;case MSG_TYPE_AUTH_OK:g.removeEventListener('message',j),g.removeEventListener('close',i),g.removeEventListener('error',i),e(g);break;default:}};g.addEventListener('message',j),g.addEventListener('close',i),g.addEventListener('error',i)}return new Promise(function(a,d){return c(b.setupRetry||0,a,d)})}function extractResult(a){return a.result}var Connection=function(a,b){this.url=a,this.options=b||{},this.commandId=1,this.commands={},this.eventListeners={},this.closeRequested=!1,this._handleMessage=this._handleMessage.bind(this),this._handleClose=this._handleClose.bind(this)};Connection.prototype.setSocket=function(a){var b=this,c=this.socket;if(this.socket=a,a.addEventListener('message',this._handleMessage),a.addEventListener('close',this._handleClose),c){var d=this.commands;this.commandId=1,this.commands={},Object.keys(d).forEach(function(a){var c=d[a];c.eventType&&b.subscribeEvents(c.eventCallback,c.eventType).then(function(a){c.unsubscribe=a})}),this.fireEvent('ready')}},Connection.prototype.addEventListener=function(a,b){var c=this.eventListeners[a];c||(c=this.eventListeners[a]=[]),c.push(b)},Connection.prototype.removeEventListener=function(a,b){var c=this.eventListeners[a];if(c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}},Connection.prototype.fireEvent=function(a,b){var c=this;(this.eventListeners[a]||[]).forEach(function(a){return a(c,b)})},Connection.prototype.close=function(){this.closeRequested=!0,this.socket.close()},Connection.prototype.getStates=function(){return this.sendMessagePromise(states()).then(extractResult)},Connection.prototype.getServices=function(){return this.sendMessagePromise(services()).then(extractResult)},Connection.prototype.getConfig=function(){return this.sendMessagePromise(config()).then(extractResult)},Connection.prototype.callService=function(a,b,c){return this.sendMessagePromise(callService(a,b,c))},Connection.prototype.subscribeEvents=function(a,b){var c=this;return this.sendMessagePromise(subscribeEvents(b)).then(function(d){var e={eventCallback:a,eventType:b,unsubscribe:function(){return c.sendMessagePromise(unsubscribeEvents(d.id)).then(function(){delete c.commands[d.id]})}};return c.commands[d.id]=e,function(){return e.unsubscribe()}})},Connection.prototype.ping=function(){return this.sendMessagePromise(ping())},Connection.prototype.sendMessage=function(a){this.socket.send(JSON.stringify(a))},Connection.prototype.sendMessagePromise=function(a){var b=this;return new Promise(function(c,d){b.commandId+=1;var e=b.commandId;a.id=e,b.commands[e]={resolve:c,reject:d},b.sendMessage(a)})},Connection.prototype._handleMessage=function(a){var b=JSON.parse(a.data);switch(b.type){case MSG_TYPE_EVENT:this.commands[b.id].eventCallback(b.event);break;case MSG_TYPE_RESULT:b.success?this.commands[b.id].resolve(b):this.commands[b.id].reject(b.error),delete this.commands[b.id];break;case MSG_TYPE_PONG:break;default:}},Connection.prototype._handleClose=function(){var a=this;if(Object.keys(this.commands).forEach(function(b){var c=a.commands[b],d=c.reject;d&&d(error(ERR_CONNECTION_LOST,'Connection lost'))}),!this.closeRequested){this.fireEvent('disconnected');var b=Object.assign({},this.options,{setupRetry:0}),c=function(d){setTimeout(function(){getSocket(a.url,b).then(function(b){return a.setSocket(b)},function(b){return b===ERR_INVALID_AUTH?a.fireEvent('reconnect-error',b):c(d+1)})},1e3*Math.min(d,5))};c(0)}};function createConnection(a,b){return void 0===b&&(b={}),getSocket(a,b).then(function(c){var d=new Connection(a,b);return d.setSocket(c),d})}function subscribeConfig(a,b){return a._subscribeConfig?a._subscribeConfig(b):new Promise(function(c,d){var e=null,f=null,g=[],h=null;b&&g.push(b);var i=function(a){e=Object.assign({},e,a);for(var b=0;b<g.length;b++)g[b](e)},j=function(a,b){var c;return i({services:Object.assign({},e.services,(c={},c[a]=b,c))})},k=function(a){if(null!==e){var b=Object.assign({},e.core,{components:e.core.components.concat(a.data.component)});i({core:b})}},l=function(a){var b;if(null!==e){var c=a.data,d=c.domain,f=c.service,g=Object.assign({},e.services[d]||{},(b={},b[f]={description:'',fields:{}},b));j(d,g)}},m=function(a){if(null!==e){var b=a.data,c=b.domain,d=b.service,f=e.services[c];if(f&&d in f){var g={};Object.keys(f).forEach(function(a){a!==d&&(g[a]=f[a])}),j(c,g)}}},n=function(){return Promise.all([a.getConfig(),a.getServices()]).then(function(a){var b=a[0],c=a[1];i({core:b,services:c})})},o=function(a){a&&g.splice(g.indexOf(a),1),0===g.length&&f()};a._subscribeConfig=function(a){return a&&(g.push(a),null!==e&&a(e)),h.then(function(){return function(){return o(a)}})},h=Promise.all([a.subscribeEvents(k,'component_loaded'),a.subscribeEvents(l,'service_registered'),a.subscribeEvents(m,'service_removed'),n()]),h.then(function(d){var e=d[0],g=d[1],h=d[2];f=function(){a.removeEventListener('ready',n),e(),g(),h()},a.addEventListener('ready',n),c(function(){return o(b)})},function(){return d()})})}function getEntities(a){for(var b,c={},d=0;d<a.length;d++)b=a[d],c[b.entity_id]=b;return c}function updateState(a,b){var c=Object.assign({},a);return c[b.entity_id]=b,c}function removeState(a,b){var c=Object.assign({},a);return delete c[b],c}function subscribeEntities(a,b){return a._subscribeEntities?a._subscribeEntities(b):new Promise(function(c,d){function e(a){if(null!==h){var b=a.data,c=b.entity_id,d=b.new_state;h=d?updateState(h,d):removeState(h,c);for(var e=0;e<j.length;e++)j[e](h)}}function f(){return a.getStates().then(function(a){h=getEntities(a);for(var b=0;b<j.length;b++)j[b](h)})}function g(b){b&&j.splice(j.indexOf(b),1),0===j.length&&(i(),a.removeEventListener('ready',f),a._subscribeEntities=null)}var h=null,i=null,j=[],k=null;b&&j.push(b),a._subscribeEntities=function(a){return a&&(j.push(a),null!==h&&a(h)),k.then(function(){return function(){return g(a)}})},k=Promise.all([a.subscribeEvents(e,'state_changed'),f()]),k.then(function(d){var e=d[0];i=e,a.addEventListener('ready',f),c(function(){return g(b)})},function(){return d()})})}export{ERR_CANNOT_CONNECT,ERR_INVALID_AUTH,ERR_CONNECTION_LOST,createConnection,subscribeConfig,subscribeEntities};\n","import { storeTokens, loadTokens } from './token_storage.js';\n\nfunction genClientId() {\n  return `${location.protocol}//${location.host}/`;\n}\n\n\nexport function redirectLogin() {\n  document.location.href = `/auth/authorize?response_type=code&client_id=${encodeURIComponent(genClientId())}&redirect_uri=${encodeURIComponent(location.toString())}`;\n  return new Promise((() => {}));\n}\n\n\nfunction fetchTokenRequest(code) {\n  const data = new FormData();\n  data.append('client_id', genClientId());\n  data.append('grant_type', 'authorization_code');\n  data.append('code', code);\n  return fetch('/auth/token', {\n    credentials: 'same-origin',\n    method: 'POST',\n    body: data,\n  }).then((resp) => {\n    if (!resp.ok) throw new Error('Unable to fetch tokens');\n    return resp.json().then((tokens) => {\n      tokens.expires = (tokens.expires_in * 1000) + Date.now();\n      return tokens;\n    });\n  });\n}\n\nfunction refreshTokenRequest(tokens) {\n  const data = new FormData();\n  data.append('client_id', genClientId());\n  data.append('grant_type', 'refresh_token');\n  data.append('refresh_token', tokens.refresh_token);\n  return fetch('/auth/token', {\n    credentials: 'same-origin',\n    method: 'POST',\n    body: data,\n  }).then((resp) => {\n    if (!resp.ok) throw new Error('Unable to fetch tokens');\n    return resp.json().then((newTokens) => {\n      newTokens.expires = (newTokens.expires_in * 1000) + Date.now();\n      return newTokens;\n    });\n  });\n}\n\nexport function resolveCode(code) {\n  return fetchTokenRequest(code).then((tokens) => {\n    storeTokens(tokens);\n    history.replaceState(null, null, location.pathname);\n    return tokens;\n  }, (err) => {\n    // eslint-disable-next-line\n    console.error('Resolve token failed', err);\n    alert('Unable to fetch tokens');\n    redirectLogin();\n  });\n}\n\n\nexport function refreshToken() {\n  const tokens = loadTokens();\n\n  if (tokens === null) {\n    return redirectLogin();\n  }\n\n  return refreshTokenRequest(tokens).then((accessTokenResp) => {\n    const newTokens = Object.assign({}, tokens, accessTokenResp);\n    storeTokens(newTokens);\n    return newTokens;\n  }, () => redirectLogin());\n}\n"],"sourceRoot":""}